package transactions

import (
	"github.com/ledgerwatch/erigon-lib/common"
	"github.com/ledgerwatch/erigon-lib/common/hexutil"
	"github.com/ledgerwatch/erigon-lib/common/hexutility"
	"github.com/ledgerwatch/erigon/accounts/abi"
	"github.com/ledgerwatch/erigon/turbo/adapter/ethapi"
	"strings"
)

var (
	_jsondata = `
[
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "_decodeBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "_decodeBytes32",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "_decodeString",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			}
		],
		"name": "balance",
		"outputs": [
			{
				"internalType": "bool[]",
				"name": "",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "bytesToHexString",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			},
			{
				"internalType": "address[][]",
				"name": "users",
				"type": "address[][]"
			}
		],
		"name": "tokenBalance",
		"outputs": [
			{
				"internalType": "uint256[][]",
				"name": "",
				"type": "uint256[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			}
		],
		"name": "tokenInfo",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "names",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "symbols",
				"type": "string[]"
			},
			{
				"internalType": "uint256[]",
				"name": "decimals",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "hasDecimals",
				"type": "bool[]"
			},
			{
				"internalType": "uint256[]",
				"name": "totalSupplies",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "hasTotalSupply",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
`
	_deployCode          = "0x608060405234801561001057600080fd5b506004361061007d5760003560e01c80637d520c221161005b5780637d520c22146101175780639496146014610147578063cadda4ba14610177578063dfca5f24146101a75761007d565b80631a5d94c41461008257806328523bc3146100b25780636f28a812146100e2575b600080fd5b61009c600480360381019061009791906118a5565b6101d7565b6040516100a99190611de7565b60405180910390f35b6100cc60048036038101906100c79190611839565b6101f3565b6040516100d99190611cf6565b60405180910390f35b6100fc60048036038101906100f791906117f8565b61053a565b60405161010e96959493929190611d3a565b60405180910390f35b610131600480360381019061012c91906118a5565b6110a3565b60405161013e9190611de7565b60405180910390f35b610161600480360381019061015c91906118a5565b611326565b60405161016e9190611de7565b60405180910390f35b610191600480360381019061018c91906117f8565b611343565b60405161019e9190611d18565b60405180910390f35b6101c160048036038101906101bc91906118a5565b6114e4565b6040516101ce9190611e09565b60405180910390f35b60606000602083015190506101eb81611501565b915050919050565b606080835167ffffffffffffffff8111801561020e57600080fd5b5060405190808252806020026020018201604052801561024257816020015b606081526020019060019003908161022d5790505b50905060005b845181101561052f57606084828151811061025f57fe5b602002602001015190506060815167ffffffffffffffff8111801561028357600080fd5b506040519080825280602002602001820160405280156102b25781602001602082028036833780820191505090505b50905060005b825181101561050757600060608986815181106102d157fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff16631dcd650086858151811061030057fe5b60200260200101516040516024016103189190611cdb565b6040516020818303038152906040527f70a08231000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516103a29190611cc4565b6000604051808303818686fa925050503d80600081146103de576040519150601f19603f3d011682016040523d82523d6000602084013e6103e3565b606091505b509150915081156104dd5760008151141561041757600084848151811061040657fe5b6020026020010181815250506104d8565b3073ffffffffffffffffffffffffffffffffffffffff1663dfca5f24826040518263ffffffff1660e01b81526004016104509190611dc5565b60206040518083038186803b15801561046857600080fd5b505afa92505050801561049957506040513d601f19601f820116820180604052508101906104969190611927565b60015b6104bc5760008484815181106104ab57fe5b6020026020010181815250506104d7565b808585815181106104c957fe5b602002602001018181525050505b5b6104f8565b60008484815181106104eb57fe5b6020026020010181815250505b505080806001019150506102b8565b508084848151811061051557fe5b602002602001018190525050508080600101915050610248565b508091505092915050565b606080606080606080865167ffffffffffffffff8111801561055b57600080fd5b5060405190808252806020026020018201604052801561058f57816020015b606081526020019060019003908161057a5790505b509550865167ffffffffffffffff811180156105aa57600080fd5b506040519080825280602002602001820160405280156105de57816020015b60608152602001906001900390816105c95790505b509450865167ffffffffffffffff811180156105f957600080fd5b506040519080825280602002602001820160405280156106285781602001602082028036833780820191505090505b509350865167ffffffffffffffff8111801561064357600080fd5b506040519080825280602002602001820160405280156106725781602001602082028036833780820191505090505b509250865167ffffffffffffffff8111801561068d57600080fd5b506040519080825280602002602001820160405280156106bc5781602001602082028036833780820191505090505b509150865167ffffffffffffffff811180156106d757600080fd5b506040519080825280602002602001820160405280156107065781602001602082028036833780820191505090505b5090506000606060005b89518110156110975760008a828151811061072757fe5b602002602001015190508073ffffffffffffffffffffffffffffffffffffffff16631dcd65006040516024016040516020818303038152906040527f06fdde03000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516107dd9190611cc4565b6000604051808303818686fa925050503d8060008114610819576040519150601f19603f3d011682016040523d82523d6000602084013e61081e565b606091505b50809450819550505083156109dd5760008351141561086357604051806020016040528060008152508a838151811061085357fe5b60200260200101819052506109d8565b3073ffffffffffffffffffffffffffffffffffffffff166394961460846040518263ffffffff1660e01b815260040161089c9190611dc5565b60006040518083038186803b1580156108b457600080fd5b505afa9250505080156108ea57506040513d6000823e3d601f19601f820116820180604052508101906108e791906118e6565b60015b6109bd573073ffffffffffffffffffffffffffffffffffffffff16631a5d94c4846040518263ffffffff1660e01b81526004016109279190611dc5565b60006040518083038186803b15801561093f57600080fd5b505afa92505050801561097557506040513d6000823e3d601f19601f8201168201806040525081019061097291906118e6565b60015b61099e57610982836110a3565b8a838151811061098e57fe5b60200260200101819052506109b8565b808b84815181106109ab57fe5b6020026020010181905250505b6109d7565b808b84815181106109ca57fe5b6020026020010181905250505b5b610a2b565b6040518060400160405280600c81526020017f63657274696b2d66616c736500000000000000000000000000000000000000008152508a8381518110610a1f57fe5b60200260200101819052505b8073ffffffffffffffffffffffffffffffffffffffff16631dcd65006040516024016040516020818303038152906040527f95d89b41000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610ad79190611cc4565b6000604051808303818686fa925050503d8060008114610b13576040519150601f19603f3d011682016040523d82523d6000602084013e610b18565b606091505b5080945081955050508315610cd757600083511415610b5d5760405180602001604052806000815250898381518110610b4d57fe5b6020026020010181905250610cd2565b3073ffffffffffffffffffffffffffffffffffffffff166394961460846040518263ffffffff1660e01b8152600401610b969190611dc5565b60006040518083038186803b158015610bae57600080fd5b505afa925050508015610be457506040513d6000823e3d601f19601f82011682018060405250810190610be191906118e6565b60015b610cb7573073ffffffffffffffffffffffffffffffffffffffff16631a5d94c4846040518263ffffffff1660e01b8152600401610c219190611dc5565b60006040518083038186803b158015610c3957600080fd5b505afa925050508015610c6f57506040513d6000823e3d601f19601f82011682018060405250810190610c6c91906118e6565b60015b610c9857610c7c836110a3565b898381518110610c8857fe5b6020026020010181905250610cb2565b808a8481518110610ca557fe5b6020026020010181905250505b610cd1565b808a8481518110610cc457fe5b6020026020010181905250505b5b610d25565b6040518060400160405280600c81526020017f63657274696b2d66616c73650000000000000000000000000000000000000000815250898381518110610d1957fe5b60200260200101819052505b8073ffffffffffffffffffffffffffffffffffffffff16631dcd65006040516024016040516020818303038152906040527f313ce567000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610dd19190611cc4565b6000604051808303818686fa925050503d8060008114610e0d576040519150601f19603f3d011682016040523d82523d6000602084013e610e12565b606091505b5080945081955050508315610e9c576001878381518110610e2f57fe5b602002602001019015159081151581525050600083511415610e6a576000888381518110610e5957fe5b602002602001018181525050610e97565b82806020019051810190610e7e9190611927565b888381518110610e8a57fe5b6020026020010181815250505b610ed7565b6000878381518110610eaa57fe5b6020026020010190151590811515815250506000888381518110610eca57fe5b6020026020010181815250505b8073ffffffffffffffffffffffffffffffffffffffff16631dcd65006040516024016040516020818303038152906040527f18160ddd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610f839190611cc4565b6000604051808303818686fa925050503d8060008114610fbf576040519150601f19603f3d011682016040523d82523d6000602084013e610fc4565b606091505b508094508195505050831561104e576001858381518110610fe157fe5b60200260200101901515908115158152505060008351141561101c57600086838151811061100b57fe5b602002602001018181525050611049565b828060200190518101906110309190611927565b86838151811061103c57fe5b6020026020010181815250505b611089565b600085838151811061105c57fe5b602002602001019015159081151581525050600086838151811061107c57fe5b6020026020010181815250505b508080600101915050610710565b50505091939550919395565b6060806040518060400160405280601081526020017f303132333435363738396162636465660000000000000000000000000000000081525090506060600284510260020167ffffffffffffffff811180156110fe57600080fd5b506040519080825280601f01601f1916602001820160405280156111315781602001600182028036833780820191505090505b5090507f30000000000000000000000000000000000000000000000000000000000000008160008151811061116257fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053507f7800000000000000000000000000000000000000000000000000000000000000816001815181106111bf57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535060005b845181101561131b5782600486838151811061120957fe5b602001015160f81c60f81b7effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916901c60f81c60ff168151811061124857fe5b602001015160f81c60f81b82600283026002018151811061126557fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535082600f60f81b8683815181106112a657fe5b602001015160f81c60f81b1660f81c60ff16815181106112c257fe5b602001015160f81c60f81b8260028302600301815181106112df57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535080806001019150506111f1565b508092505050919050565b60608180602001905181019061133c91906118e6565b9050919050565b606080825167ffffffffffffffff8111801561135e57600080fd5b5060405190808252806020026020018201604052801561138d5781602001602082028036833780820191505090505b50905060005b83518110156114da5760008482815181106113aa57fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff16631dcd6500306040516024016113de9190611cdb565b6040516020818303038152906040527f70a08231000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516114689190611cc4565b6000604051808303818686fa925050503d80600081146114a4576040519150601f19603f3d011682016040523d82523d6000602084013e6114a9565b606091505b50509050808383815181106114ba57fe5b602002602001019015159081151581525050508080600101915050611393565b5080915050919050565b6000818060200190518101906114fa9190611927565b9050919050565b606060005b60208160ff161080156115515750600060f81b838260ff166020811061152857fe5b1a60f81b7effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614155b15611563578080600101915050611506565b60608160ff1667ffffffffffffffff8111801561157f57600080fd5b506040519080825280601f01601f1916602001820160405280156115b25781602001600182028036833780820191505090505b50905060005b8260ff168160ff16101561162457848160ff16602081106115d557fe5b1a60f81b828260ff16815181106115e857fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535080806001019150506115b8565b508092505050919050565b60008135905061163e816120dd565b92915050565b600082601f83011261165557600080fd5b813561166861166382611e51565b611e24565b9150818183526020840193506020810190508385602084028201111561168d57600080fd5b60005b838110156116bd57816116a3888261162f565b845260208401935060208301925050600181019050611690565b5050505092915050565b600082601f8301126116d857600080fd5b81356116eb6116e682611e79565b611e24565b9150818183526020840193506020810190508360005b8381101561173157813586016117178882611644565b845260208401935060208301925050600181019050611701565b5050505092915050565b600082601f83011261174c57600080fd5b813561175f61175a82611ea1565b611e24565b9150808252602083016020830185838301111561177b57600080fd5b61178683828461208a565b50505092915050565b600082601f8301126117a057600080fd5b81516117b36117ae82611ecd565b611e24565b915080825260208301602083018583830111156117cf57600080fd5b6117da838284612099565b50505092915050565b6000815190506117f2816120f4565b92915050565b60006020828403121561180a57600080fd5b600082013567ffffffffffffffff81111561182457600080fd5b61183084828501611644565b91505092915050565b6000806040838503121561184c57600080fd5b600083013567ffffffffffffffff81111561186657600080fd5b61187285828601611644565b925050602083013567ffffffffffffffff81111561188f57600080fd5b61189b858286016116c7565b9150509250929050565b6000602082840312156118b757600080fd5b600082013567ffffffffffffffff8111156118d157600080fd5b6118dd8482850161173b565b91505092915050565b6000602082840312156118f857600080fd5b600082015167ffffffffffffffff81111561191257600080fd5b61191e8482850161178f565b91505092915050565b60006020828403121561193957600080fd5b6000611947848285016117e3565b91505092915050565b600061195c8383611aff565b905092915050565b60006119708383611bbb565b60208301905092915050565b60006119888383611c34565b905092915050565b600061199c8383611ca6565b60208301905092915050565b6119b181612042565b82525050565b60006119c282611f39565b6119cc8185611faf565b9350836020820285016119de85611ef9565b8060005b85811015611a1a57848403895281516119fb8582611950565b9450611a0683611f7b565b925060208a019950506001810190506119e2565b50829750879550505050505092915050565b6000611a3782611f44565b611a418185611fc0565b9350611a4c83611f09565b8060005b83811015611a7d578151611a648882611964565b9750611a6f83611f88565b925050600181019050611a50565b5085935050505092915050565b6000611a9582611f4f565b611a9f8185611fd1565b935083602082028501611ab185611f19565b8060005b85811015611aed5784840389528151611ace858261197c565b9450611ad983611f95565b925060208a01995050600181019050611ab5565b50829750879550505050505092915050565b6000611b0a82611f5a565b611b148185611fe2565b9350611b1f83611f29565b8060005b83811015611b50578151611b378882611990565b9750611b4283611fa2565b925050600181019050611b23565b5085935050505092915050565b6000611b6882611f5a565b611b728185611ff3565b9350611b7d83611f29565b8060005b83811015611bae578151611b958882611990565b9750611ba083611fa2565b925050600181019050611b81565b5085935050505092915050565b611bc481612054565b82525050565b6000611bd582611f65565b611bdf8185612004565b9350611bef818560208601612099565b611bf8816120cc565b840191505092915050565b6000611c0e82611f65565b611c188185612015565b9350611c28818560208601612099565b80840191505092915050565b6000611c3f82611f70565b611c498185612020565b9350611c59818560208601612099565b611c62816120cc565b840191505092915050565b6000611c7882611f70565b611c828185612031565b9350611c92818560208601612099565b611c9b816120cc565b840191505092915050565b611caf81612080565b82525050565b611cbe81612080565b82525050565b6000611cd08284611c03565b915081905092915050565b6000602082019050611cf060008301846119a8565b92915050565b60006020820190508181036000830152611d1081846119b7565b905092915050565b60006020820190508181036000830152611d328184611a2c565b905092915050565b600060c0820190508181036000830152611d548189611a8a565b90508181036020830152611d688188611a8a565b90508181036040830152611d7c8187611b5d565b90508181036060830152611d908186611a2c565b90508181036080830152611da48185611b5d565b905081810360a0830152611db88184611a2c565b9050979650505050505050565b60006020820190508181036000830152611ddf8184611bca565b905092915050565b60006020820190508181036000830152611e018184611c6d565b905092915050565b6000602082019050611e1e6000830184611cb5565b92915050565b6000604051905081810181811067ffffffffffffffff82111715611e4757600080fd5b8060405250919050565b600067ffffffffffffffff821115611e6857600080fd5b602082029050602081019050919050565b600067ffffffffffffffff821115611e9057600080fd5b602082029050602081019050919050565b600067ffffffffffffffff821115611eb857600080fd5b601f19601f8301169050602081019050919050565b600067ffffffffffffffff821115611ee457600080fd5b601f19601f8301169050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600061204d82612060565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b838110156120b757808201518184015260208101905061209c565b838111156120c6576000848401525b50505050565b6000601f19601f8301169050919050565b6120e681612042565b81146120f157600080fd5b50565b6120fd81612080565b811461210857600080fd5b5056fea26469706673582212206f1120bea7609f046f2dfcf69afb739cfb9d3dfe6ea24d46b4e090d5856ed0e864736f6c634300060c0033"
	TokenContractCaller  = common.HexToAddress("0x1992111111111111111111111111111111111110")
	TokenContractAddress = common.HexToAddress("0x1992111111111111111111111111111111111111")
)

type TokenContract struct {
	caller  common.Address
	address common.Address
	code    []byte
	abi     abi.ABI
}

func NewTokenContract() TokenContract {
	_abi, _ := abi.JSON(strings.NewReader(_jsondata))
	return TokenContract{
		caller:  TokenContractCaller,
		address: TokenContractAddress,
		code:    hexutil.MustDecode(_deployCode),
		abi:     _abi,
	}
}

func (tc *TokenContract) Override() *ethapi.StateOverrides {
	return &ethapi.StateOverrides{
		tc.address: ethapi.Account{
			Nonce:     nil,
			Code:      (*hexutility.Bytes)(&tc.code),
			Balance:   nil,
			State:     nil,
			StateDiff: nil,
		},
	}
}
