package transactions

import (
	"github.com/ledgerwatch/erigon-lib/common"
	"github.com/ledgerwatch/erigon-lib/common/hexutil"
	"github.com/ledgerwatch/erigon-lib/common/hexutility"
	"github.com/ledgerwatch/erigon/accounts/abi"
	"github.com/ledgerwatch/erigon/turbo/adapter/ethapi"
	"strings"
)

var (
	_jsondata = `
[
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "_decodeBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			}
		],
		"name": "balance",
		"outputs": [
			{
				"internalType": "bool[]",
				"name": "",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			},
			{
				"internalType": "address[][]",
				"name": "users",
				"type": "address[][]"
			}
		],
		"name": "tokenBalance",
		"outputs": [
			{
				"internalType": "uint256[][]",
				"name": "",
				"type": "uint256[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			}
		],
		"name": "tokenInfo",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "names",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "symbols",
				"type": "string[]"
			},
			{
				"internalType": "uint256[]",
				"name": "decimals",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "hasDecimals",
				"type": "bool[]"
			},
			{
				"internalType": "uint256[]",
				"name": "totalSupplies",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "hasTotalSupply",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
`
	_deployCode          = "0x608060405234801561001057600080fd5b506004361061004c5760003560e01c806328523bc3146100515780636f28a81214610081578063cadda4ba146100b6578063dfca5f24146100e6575b600080fd5b61006b60048036038101906100669190611226565b610116565b60405161007891906116aa565b60405180910390f35b61009b600480360381019061009691906111e5565b610457565b6040516100ad969594939291906116ee565b60405180910390f35b6100d060048036038101906100cb91906111e5565b610d36565b6040516100dd91906116cc565b60405180910390f35b61010060048036038101906100fb9190611292565b610ed1565b60405161010d919061179b565b60405180910390f35b606080835167ffffffffffffffff8111801561013157600080fd5b5060405190808252806020026020018201604052801561016557816020015b60608152602001906001900390816101505790505b50905060005b845181101561044c57606084828151811061018257fe5b602002602001015190506060815167ffffffffffffffff811180156101a657600080fd5b506040519080825280602002602001820160405280156101d55781602001602082028036833780820191505090505b50905060005b825181101561042457600060608986815181106101f457fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1685848151811061021e57fe5b6020026020010151604051602401610236919061168f565b6040516020818303038152906040527f70a08231000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516102c09190611678565b600060405180830381855afa9150503d80600081146102fb576040519150601f19603f3d011682016040523d82523d6000602084013e610300565b606091505b509150915081156103fa5760008151141561033457600084848151811061032357fe5b6020026020010181815250506103f5565b3073ffffffffffffffffffffffffffffffffffffffff1663dfca5f24826040518263ffffffff1660e01b815260040161036d9190611779565b60206040518083038186803b15801561038557600080fd5b505afa9250505080156103b657506040513d601f19601f820116820180604052508101906103b39190611314565b60015b6103d95760008484815181106103c857fe5b6020026020010181815250506103f4565b808585815181106103e657fe5b602002602001018181525050505b5b610415565b600084848151811061040857fe5b6020026020010181815250505b505080806001019150506101db565b508084848151811061043257fe5b60200260200101819052505050808060010191505061016b565b508091505092915050565b606080606080606080865167ffffffffffffffff8111801561047857600080fd5b506040519080825280602002602001820160405280156104ac57816020015b60608152602001906001900390816104975790505b509550865167ffffffffffffffff811180156104c757600080fd5b506040519080825280602002602001820160405280156104fb57816020015b60608152602001906001900390816104e65790505b509450865167ffffffffffffffff8111801561051657600080fd5b506040519080825280602002602001820160405280156105455781602001602082028036833780820191505090505b509350865167ffffffffffffffff8111801561056057600080fd5b5060405190808252806020026020018201604052801561058f5781602001602082028036833780820191505090505b509250865167ffffffffffffffff811180156105aa57600080fd5b506040519080825280602002602001820160405280156105d95781602001602082028036833780820191505090505b509150865167ffffffffffffffff811180156105f457600080fd5b506040519080825280602002602001820160405280156106235781602001602082028036833780820191505090505b5090506000606060005b8951811015610d2a5760008a828151811061064457fe5b602002602001015190508073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f06fdde03000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516106f59190611678565b600060405180830381855afa9150503d8060008114610730576040519150601f19603f3d011682016040523d82523d6000602084013e610735565b606091505b50809450819550505083156107e55760208351141561077d5760006020840151905061076081610eee565b8b848151811061076c57fe5b6020026020010181905250506107e0565b6020835111156107b7578280602001905181019061079b91906112d3565b8a83815181106107a757fe5b60200260200101819052506107df565b604051806020016040528060008152508a83815181106107d357fe5b60200260200101819052505b5b610833565b6040518060400160405280600c81526020017f63657274696b2d66616c736500000000000000000000000000000000000000008152508a838151811061082757fe5b60200260200101819052505b8073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f95d89b41000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516108da9190611678565b600060405180830381855afa9150503d8060008114610915576040519150601f19603f3d011682016040523d82523d6000602084013e61091a565b606091505b50809450819550505083156109ca576020835114156109625760006020840151905061094581610eee565b8a848151811061095157fe5b6020026020010181905250506109c5565b60208351111561099c578280602001905181019061098091906112d3565b89838151811061098c57fe5b60200260200101819052506109c4565b604051806020016040528060008152508983815181106109b857fe5b60200260200101819052505b5b610a18565b6040518060400160405280600c81526020017f63657274696b2d66616c73650000000000000000000000000000000000000000815250898381518110610a0c57fe5b60200260200101819052505b8073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f313ce567000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610abf9190611678565b600060405180830381855afa9150503d8060008114610afa576040519150601f19603f3d011682016040523d82523d6000602084013e610aff565b606091505b5080945081955050508315610b5f576001878381518110610b1c57fe5b60200260200101901515908115158152505082806020019051810190610b429190611314565b888381518110610b4e57fe5b602002602001018181525050610b9a565b6000878381518110610b6d57fe5b6020026020010190151590811515815250506000888381518110610b8d57fe5b6020026020010181815250505b8073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f18160ddd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610c419190611678565b600060405180830381855afa9150503d8060008114610c7c576040519150601f19603f3d011682016040523d82523d6000602084013e610c81565b606091505b5080945081955050508315610ce1576001858381518110610c9e57fe5b60200260200101901515908115158152505082806020019051810190610cc49190611314565b868381518110610cd057fe5b602002602001018181525050610d1c565b6000858381518110610cef57fe5b6020026020010190151590811515815250506000868381518110610d0f57fe5b6020026020010181815250505b50808060010191505061062d565b50505091939550919395565b606080825167ffffffffffffffff81118015610d5157600080fd5b50604051908082528060200260200182016040528015610d805781602001602082028036833780820191505090505b50905060005b8351811015610ec7576000848281518110610d9d57fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1630604051602401610dcc919061168f565b6040516020818303038152906040527f70a08231000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610e569190611678565b600060405180830381855afa9150503d8060008114610e91576040519150601f19603f3d011682016040523d82523d6000602084013e610e96565b606091505b5050905080838381518110610ea757fe5b602002602001019015159081151581525050508080600101915050610d86565b5080915050919050565b600081806020019051810190610ee79190611314565b9050919050565b606060005b60208160ff16108015610f3e5750600060f81b838260ff1660208110610f1557fe5b1a60f81b7effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614155b15610f50578080600101915050610ef3565b60608160ff1667ffffffffffffffff81118015610f6c57600080fd5b506040519080825280601f01601f191660200182016040528015610f9f5781602001600182028036833780820191505090505b50905060005b8260ff168160ff16101561101157848160ff1660208110610fc257fe5b1a60f81b828260ff1681518110610fd557fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080600101915050610fa5565b508092505050919050565b60008135905061102b81611a5e565b92915050565b600082601f83011261104257600080fd5b8135611055611050826117e3565b6117b6565b9150818183526020840193506020810190508385602084028201111561107a57600080fd5b60005b838110156110aa5781611090888261101c565b84526020840193506020830192505060018101905061107d565b5050505092915050565b600082601f8301126110c557600080fd5b81356110d86110d38261180b565b6117b6565b9150818183526020840193506020810190508360005b8381101561111e57813586016111048882611031565b8452602084019350602083019250506001810190506110ee565b5050505092915050565b600082601f83011261113957600080fd5b813561114c61114782611833565b6117b6565b9150808252602083016020830185838301111561116857600080fd5b611173838284611a0b565b50505092915050565b600082601f83011261118d57600080fd5b81516111a061119b8261185f565b6117b6565b915080825260208301602083018583830111156111bc57600080fd5b6111c7838284611a1a565b50505092915050565b6000815190506111df81611a75565b92915050565b6000602082840312156111f757600080fd5b600082013567ffffffffffffffff81111561121157600080fd5b61121d84828501611031565b91505092915050565b6000806040838503121561123957600080fd5b600083013567ffffffffffffffff81111561125357600080fd5b61125f85828601611031565b925050602083013567ffffffffffffffff81111561127c57600080fd5b611288858286016110b4565b9150509250929050565b6000602082840312156112a457600080fd5b600082013567ffffffffffffffff8111156112be57600080fd5b6112ca84828501611128565b91505092915050565b6000602082840312156112e557600080fd5b600082015167ffffffffffffffff8111156112ff57600080fd5b61130b8482850161117c565b91505092915050565b60006020828403121561132657600080fd5b6000611334848285016111d0565b91505092915050565b600061134983836114ec565b905092915050565b600061135d83836115a8565b60208301905092915050565b60006113758383611621565b905092915050565b6000611389838361165a565b60208301905092915050565b61139e816119c3565b82525050565b60006113af826118cb565b6113b98185611941565b9350836020820285016113cb8561188b565b8060005b8581101561140757848403895281516113e8858261133d565b94506113f38361190d565b925060208a019950506001810190506113cf565b50829750879550505050505092915050565b6000611424826118d6565b61142e8185611952565b93506114398361189b565b8060005b8381101561146a5781516114518882611351565b975061145c8361191a565b92505060018101905061143d565b5085935050505092915050565b6000611482826118e1565b61148c8185611963565b93508360208202850161149e856118ab565b8060005b858110156114da57848403895281516114bb8582611369565b94506114c683611927565b925060208a019950506001810190506114a2565b50829750879550505050505092915050565b60006114f7826118ec565b6115018185611974565b935061150c836118bb565b8060005b8381101561153d578151611524888261137d565b975061152f83611934565b925050600181019050611510565b5085935050505092915050565b6000611555826118ec565b61155f8185611985565b935061156a836118bb565b8060005b8381101561159b578151611582888261137d565b975061158d83611934565b92505060018101905061156e565b5085935050505092915050565b6115b1816119d5565b82525050565b60006115c2826118f7565b6115cc8185611996565b93506115dc818560208601611a1a565b6115e581611a4d565b840191505092915050565b60006115fb826118f7565b61160581856119a7565b9350611615818560208601611a1a565b80840191505092915050565b600061162c82611902565b61163681856119b2565b9350611646818560208601611a1a565b61164f81611a4d565b840191505092915050565b61166381611a01565b82525050565b61167281611a01565b82525050565b600061168482846115f0565b915081905092915050565b60006020820190506116a46000830184611395565b92915050565b600060208201905081810360008301526116c481846113a4565b905092915050565b600060208201905081810360008301526116e68184611419565b905092915050565b600060c08201905081810360008301526117088189611477565b9050818103602083015261171c8188611477565b90508181036040830152611730818761154a565b905081810360608301526117448186611419565b90508181036080830152611758818561154a565b905081810360a083015261176c8184611419565b9050979650505050505050565b6000602082019050818103600083015261179381846115b7565b905092915050565b60006020820190506117b06000830184611669565b92915050565b6000604051905081810181811067ffffffffffffffff821117156117d957600080fd5b8060405250919050565b600067ffffffffffffffff8211156117fa57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff82111561182257600080fd5b602082029050602081019050919050565b600067ffffffffffffffff82111561184a57600080fd5b601f19601f8301169050602081019050919050565b600067ffffffffffffffff82111561187657600080fd5b601f19601f8301169050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b60006119ce826119e1565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b83811015611a38578082015181840152602081019050611a1d565b83811115611a47576000848401525b50505050565b6000601f19601f8301169050919050565b611a67816119c3565b8114611a7257600080fd5b50565b611a7e81611a01565b8114611a8957600080fd5b5056fea26469706673582212200d1fba9089fee59201d3adddbe66789a3f74b97cc9ecc3380cc07badfa3950cc64736f6c634300060c0033"
	TokenContractCaller  = common.HexToAddress("0x1992111111111111111111111111111111111110")
	TokenContractAddress = common.HexToAddress("0x1992111111111111111111111111111111111111")
)

type TokenContract struct {
	caller  common.Address
	address common.Address
	code    []byte
	abi     abi.ABI
}

func NewTokenContract() TokenContract {
	_abi, _ := abi.JSON(strings.NewReader(_jsondata))
	return TokenContract{
		caller:  TokenContractCaller,
		address: TokenContractAddress,
		code:    hexutil.MustDecode(_deployCode),
		abi:     _abi,
	}
}

func (tc *TokenContract) Override() *ethapi.StateOverrides {
	return &ethapi.StateOverrides{
		tc.address: ethapi.Account{
			Nonce:     nil,
			Code:      (*hexutility.Bytes)(&tc.code),
			Balance:   nil,
			State:     nil,
			StateDiff: nil,
		},
	}
}
