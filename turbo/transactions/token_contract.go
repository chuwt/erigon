package transactions

import (
	"github.com/ledgerwatch/erigon-lib/common"
	"github.com/ledgerwatch/erigon-lib/common/hexutil"
	"github.com/ledgerwatch/erigon-lib/common/hexutility"
	"github.com/ledgerwatch/erigon/accounts/abi"
	"github.com/ledgerwatch/erigon/turbo/adapter/ethapi"
	"strings"
)

var (
	_jsondata = `
[
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "_decodeBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			}
		],
		"name": "balance",
		"outputs": [
			{
				"internalType": "bool[]",
				"name": "",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			},
			{
				"internalType": "address[][]",
				"name": "users",
				"type": "address[][]"
			}
		],
		"name": "tokenBalance",
		"outputs": [
			{
				"internalType": "uint256[][]",
				"name": "",
				"type": "uint256[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			}
		],
		"name": "tokenInfo",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "names",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "symbols",
				"type": "string[]"
			},
			{
				"internalType": "uint256[]",
				"name": "decimals",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "hasDecimals",
				"type": "bool[]"
			},
			{
				"internalType": "uint256[]",
				"name": "totalSupplies",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "hasTotalSupply",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
`
	_deployCode          = "0x608060405234801561001057600080fd5b506004361061004c5760003560e01c806328523bc3146100515780636f28a81214610081578063cadda4ba146100b6578063dfca5f24146100e6575b600080fd5b61006b6004803603810190610066919061127a565b610116565b60405161007891906116fe565b60405180910390f35b61009b60048036038101906100969190611239565b610457565b6040516100ad96959493929190611742565b60405180910390f35b6100d060048036038101906100cb9190611239565b610d8a565b6040516100dd9190611720565b60405180910390f35b61010060048036038101906100fb91906112e6565b610f25565b60405161010d91906117ef565b60405180910390f35b606080835167ffffffffffffffff8111801561013157600080fd5b5060405190808252806020026020018201604052801561016557816020015b60608152602001906001900390816101505790505b50905060005b845181101561044c57606084828151811061018257fe5b602002602001015190506060815167ffffffffffffffff811180156101a657600080fd5b506040519080825280602002602001820160405280156101d55781602001602082028036833780820191505090505b50905060005b825181101561042457600060608986815181106101f457fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1685848151811061021e57fe5b602002602001015160405160240161023691906116e3565b6040516020818303038152906040527f70a08231000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516102c091906116cc565b600060405180830381855afa9150503d80600081146102fb576040519150601f19603f3d011682016040523d82523d6000602084013e610300565b606091505b509150915081156103fa5760008151141561033457600084848151811061032357fe5b6020026020010181815250506103f5565b3073ffffffffffffffffffffffffffffffffffffffff1663dfca5f24826040518263ffffffff1660e01b815260040161036d91906117cd565b60206040518083038186803b15801561038557600080fd5b505afa9250505080156103b657506040513d601f19601f820116820180604052508101906103b39190611368565b60015b6103d95760008484815181106103c857fe5b6020026020010181815250506103f4565b808585815181106103e657fe5b602002602001018181525050505b5b610415565b600084848151811061040857fe5b6020026020010181815250505b505080806001019150506101db565b508084848151811061043257fe5b60200260200101819052505050808060010191505061016b565b508091505092915050565b606080606080606080865167ffffffffffffffff8111801561047857600080fd5b506040519080825280602002602001820160405280156104ac57816020015b60608152602001906001900390816104975790505b509550865167ffffffffffffffff811180156104c757600080fd5b506040519080825280602002602001820160405280156104fb57816020015b60608152602001906001900390816104e65790505b509450865167ffffffffffffffff8111801561051657600080fd5b506040519080825280602002602001820160405280156105455781602001602082028036833780820191505090505b509350865167ffffffffffffffff8111801561056057600080fd5b5060405190808252806020026020018201604052801561058f5781602001602082028036833780820191505090505b509250865167ffffffffffffffff811180156105aa57600080fd5b506040519080825280602002602001820160405280156105d95781602001602082028036833780820191505090505b509150865167ffffffffffffffff811180156105f457600080fd5b506040519080825280602002602001820160405280156106235781602001602082028036833780820191505090505b5090506000606060005b8951811015610d7e5760008a828151811061064457fe5b602002602001015190508073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f06fdde03000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516106f591906116cc565b600060405180830381855afa9150503d8060008114610730576040519150601f19603f3d011682016040523d82523d6000602084013e610735565b606091505b50809450819550505083156107e55760208351141561077d5760006020840151905061076081610f42565b8b848151811061076c57fe5b6020026020010181905250506107e0565b6020835111156107b7578280602001905181019061079b9190611327565b8a83815181106107a757fe5b60200260200101819052506107df565b604051806020016040528060008152508a83815181106107d357fe5b60200260200101819052505b5b610833565b6040518060400160405280600c81526020017f63657274696b2d66616c736500000000000000000000000000000000000000008152508a838151811061082757fe5b60200260200101819052505b8073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f95d89b41000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516108da91906116cc565b600060405180830381855afa9150503d8060008114610915576040519150601f19603f3d011682016040523d82523d6000602084013e61091a565b606091505b50809450819550505083156109ca576020835114156109625760006020840151905061094581610f42565b8a848151811061095157fe5b6020026020010181905250506109c5565b60208351111561099c57828060200190518101906109809190611327565b89838151811061098c57fe5b60200260200101819052506109c4565b604051806020016040528060008152508983815181106109b857fe5b60200260200101819052505b5b610a18565b6040518060400160405280600c81526020017f63657274696b2d66616c73650000000000000000000000000000000000000000815250898381518110610a0c57fe5b60200260200101819052505b8073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f313ce567000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610abf91906116cc565b600060405180830381855afa9150503d8060008114610afa576040519150601f19603f3d011682016040523d82523d6000602084013e610aff565b606091505b5080945081955050508315610b89576001878381518110610b1c57fe5b602002602001019015159081151581525050600083511415610b57576000888381518110610b4657fe5b602002602001018181525050610b84565b82806020019051810190610b6b9190611368565b888381518110610b7757fe5b6020026020010181815250505b610bc4565b6000878381518110610b9757fe5b6020026020010190151590811515815250506000888381518110610bb757fe5b6020026020010181815250505b8073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f18160ddd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610c6b91906116cc565b600060405180830381855afa9150503d8060008114610ca6576040519150601f19603f3d011682016040523d82523d6000602084013e610cab565b606091505b5080945081955050508315610d35576001858381518110610cc857fe5b602002602001019015159081151581525050600083511415610d03576000868381518110610cf257fe5b602002602001018181525050610d30565b82806020019051810190610d179190611368565b868381518110610d2357fe5b6020026020010181815250505b610d70565b6000858381518110610d4357fe5b6020026020010190151590811515815250506000868381518110610d6357fe5b6020026020010181815250505b50808060010191505061062d565b50505091939550919395565b606080825167ffffffffffffffff81118015610da557600080fd5b50604051908082528060200260200182016040528015610dd45781602001602082028036833780820191505090505b50905060005b8351811015610f1b576000848281518110610df157fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1630604051602401610e2091906116e3565b6040516020818303038152906040527f70a08231000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610eaa91906116cc565b600060405180830381855afa9150503d8060008114610ee5576040519150601f19603f3d011682016040523d82523d6000602084013e610eea565b606091505b5050905080838381518110610efb57fe5b602002602001019015159081151581525050508080600101915050610dda565b5080915050919050565b600081806020019051810190610f3b9190611368565b9050919050565b606060005b60208160ff16108015610f925750600060f81b838260ff1660208110610f6957fe5b1a60f81b7effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614155b15610fa4578080600101915050610f47565b60608160ff1667ffffffffffffffff81118015610fc057600080fd5b506040519080825280601f01601f191660200182016040528015610ff35781602001600182028036833780820191505090505b50905060005b8260ff168160ff16101561106557848160ff166020811061101657fe5b1a60f81b828260ff168151811061102957fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080600101915050610ff9565b508092505050919050565b60008135905061107f81611ab2565b92915050565b600082601f83011261109657600080fd5b81356110a96110a482611837565b61180a565b915081818352602084019350602081019050838560208402820111156110ce57600080fd5b60005b838110156110fe57816110e48882611070565b8452602084019350602083019250506001810190506110d1565b5050505092915050565b600082601f83011261111957600080fd5b813561112c6111278261185f565b61180a565b9150818183526020840193506020810190508360005b8381101561117257813586016111588882611085565b845260208401935060208301925050600181019050611142565b5050505092915050565b600082601f83011261118d57600080fd5b81356111a061119b82611887565b61180a565b915080825260208301602083018583830111156111bc57600080fd5b6111c7838284611a5f565b50505092915050565b600082601f8301126111e157600080fd5b81516111f46111ef826118b3565b61180a565b9150808252602083016020830185838301111561121057600080fd5b61121b838284611a6e565b50505092915050565b60008151905061123381611ac9565b92915050565b60006020828403121561124b57600080fd5b600082013567ffffffffffffffff81111561126557600080fd5b61127184828501611085565b91505092915050565b6000806040838503121561128d57600080fd5b600083013567ffffffffffffffff8111156112a757600080fd5b6112b385828601611085565b925050602083013567ffffffffffffffff8111156112d057600080fd5b6112dc85828601611108565b9150509250929050565b6000602082840312156112f857600080fd5b600082013567ffffffffffffffff81111561131257600080fd5b61131e8482850161117c565b91505092915050565b60006020828403121561133957600080fd5b600082015167ffffffffffffffff81111561135357600080fd5b61135f848285016111d0565b91505092915050565b60006020828403121561137a57600080fd5b600061138884828501611224565b91505092915050565b600061139d8383611540565b905092915050565b60006113b183836115fc565b60208301905092915050565b60006113c98383611675565b905092915050565b60006113dd83836116ae565b60208301905092915050565b6113f281611a17565b82525050565b60006114038261191f565b61140d8185611995565b93508360208202850161141f856118df565b8060005b8581101561145b578484038952815161143c8582611391565b945061144783611961565b925060208a01995050600181019050611423565b50829750879550505050505092915050565b60006114788261192a565b61148281856119a6565b935061148d836118ef565b8060005b838110156114be5781516114a588826113a5565b97506114b08361196e565b925050600181019050611491565b5085935050505092915050565b60006114d682611935565b6114e081856119b7565b9350836020820285016114f2856118ff565b8060005b8581101561152e578484038952815161150f85826113bd565b945061151a8361197b565b925060208a019950506001810190506114f6565b50829750879550505050505092915050565b600061154b82611940565b61155581856119c8565b93506115608361190f565b8060005b8381101561159157815161157888826113d1565b975061158383611988565b925050600181019050611564565b5085935050505092915050565b60006115a982611940565b6115b381856119d9565b93506115be8361190f565b8060005b838110156115ef5781516115d688826113d1565b97506115e183611988565b9250506001810190506115c2565b5085935050505092915050565b61160581611a29565b82525050565b60006116168261194b565b61162081856119ea565b9350611630818560208601611a6e565b61163981611aa1565b840191505092915050565b600061164f8261194b565b61165981856119fb565b9350611669818560208601611a6e565b80840191505092915050565b600061168082611956565b61168a8185611a06565b935061169a818560208601611a6e565b6116a381611aa1565b840191505092915050565b6116b781611a55565b82525050565b6116c681611a55565b82525050565b60006116d88284611644565b915081905092915050565b60006020820190506116f860008301846113e9565b92915050565b6000602082019050818103600083015261171881846113f8565b905092915050565b6000602082019050818103600083015261173a818461146d565b905092915050565b600060c082019050818103600083015261175c81896114cb565b9050818103602083015261177081886114cb565b90508181036040830152611784818761159e565b90508181036060830152611798818661146d565b905081810360808301526117ac818561159e565b905081810360a08301526117c0818461146d565b9050979650505050505050565b600060208201905081810360008301526117e7818461160b565b905092915050565b600060208201905061180460008301846116bd565b92915050565b6000604051905081810181811067ffffffffffffffff8211171561182d57600080fd5b8060405250919050565b600067ffffffffffffffff82111561184e57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff82111561187657600080fd5b602082029050602081019050919050565b600067ffffffffffffffff82111561189e57600080fd5b601f19601f8301169050602081019050919050565b600067ffffffffffffffff8211156118ca57600080fd5b601f19601f8301169050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b6000611a2282611a35565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b83811015611a8c578082015181840152602081019050611a71565b83811115611a9b576000848401525b50505050565b6000601f19601f8301169050919050565b611abb81611a17565b8114611ac657600080fd5b50565b611ad281611a55565b8114611add57600080fd5b5056fea2646970667358221220b0903e6e53d49f278aff968977ce35907bd5417e55da81c6435407fcefadad7264736f6c634300060c0033"
	TokenContractCaller  = common.HexToAddress("0x1992111111111111111111111111111111111110")
	TokenContractAddress = common.HexToAddress("0x1992111111111111111111111111111111111111")
)

type TokenContract struct {
	caller  common.Address
	address common.Address
	code    []byte
	abi     abi.ABI
}

func NewTokenContract() TokenContract {
	_abi, _ := abi.JSON(strings.NewReader(_jsondata))
	return TokenContract{
		caller:  TokenContractCaller,
		address: TokenContractAddress,
		code:    hexutil.MustDecode(_deployCode),
		abi:     _abi,
	}
}

func (tc *TokenContract) Override() *ethapi.StateOverrides {
	return &ethapi.StateOverrides{
		tc.address: ethapi.Account{
			Nonce:     nil,
			Code:      (*hexutility.Bytes)(&tc.code),
			Balance:   nil,
			State:     nil,
			StateDiff: nil,
		},
	}
}
